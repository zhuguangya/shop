{include file="header"}
<section class="Hui-article-box">
	<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> é¦–é¡µ
		<span class="c-gray en">&gt;</span>
		ç®¡ç†å‘˜ç®¡ç†
		<span class="c-gray en">&gt;</span>
		ç®¡ç†å‘˜åˆ—è¡¨ <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="åˆ·æ–°" ><i class="Hui-iconfont">&#xe68f;</i></a> </nav>
	<div class="Hui-article">
		<article class="cl pd-20">
			<!-- <div class="text-c"> æ—¥æœŸèŒƒå›´ï¼š
				<input type="text" onfocus="WdatePicker({maxDate:'#F{}'})" id="datemin" class="input-text Wdate" style="width:120px;">
				-
				<input type="text" onfocus="WdatePicker({minDate:'#F{})" id="datemax" class="input-text Wdate" style="width:120px;">
				<input type="text" class="input-text" style="width:250px" placeholder="è¾“å…¥ç®¡ç†å‘˜åç§°" id="" name="">
				<button type="submit" class="btn btn-success" id="" name=""><i class="Hui-iconfont">&#xe665;</i> æœç”¨æˆ·</button>
			</div> -->
			<div class="cl pd-5 bg-1 bk-gray mt-20">
				<span class="l"> <a href="javascript:;" onclick="datade2()" class="btn btn-danger radius"><i class="Hui-iconfont">&#xe6e2;</i> æ‰¹é‡åˆ é™¤</a> <a href="javascript:;" onclick="modaldemo()" class="btn btn-primary radius"><i class="Hui-iconfont">&#xe600;</i> æ·»åŠ ç®¡ç†å‘˜</a> </span>
				<span class="r">å…±æœ‰æ•°æ®ï¼š<strong>54</strong> æ¡</span>
			</div>
			<table class="table table-border table-bordered table-bg">
				<thead>
					<tr>
						<th scope="col" colspan="9">å‘˜å·¥åˆ—è¡¨</th>
					</tr>
					<tr class="text-c">
						<th width="25"><input type="checkbox" name="" value=""></th>
						<th width="40">ID</th>
						<th width="150">ç™»å½•å</th>
						<th width="90">å¯†ç </th>
						<th width="90">æ‰‹æœº</th>
						<th width="150">è§’è‰²</th>
						<th width="130">åŠ å…¥æ—¶é—´</th>
						<th width="100">æ˜¯å¦å·²å¯ç”¨</th>
						<th width="100">æ“ä½œ</th>
					</tr>
				</thead>
				<tbody></tbody>
			</table>
		</article>
	</div>
	<div id="modal-demo" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content radius">
			<div class="modal-header">
				<!-- <h3 class="modal-title">å¯¹è¯æ¡†æ ‡é¢˜</h3> -->
				<a class="close" data-dismiss="modal" aria-hidden="true" href="javascript:void();">Ã—</a>
			</div>
			<div class="modal-body">
				 <div class="row cl">
				<!--  <input type="text" value="" id="up_id" hidden=""> -->
				 ç”¨æˆ·åï¼š<input type="text" value="" id="user_name">
				 <br>
				  å¯†  ç ï¼š   <input type="text" value="" id="password">
				 <br>
				 æ‰‹æœºå·ï¼š<input type="text" value="" id="mobile">
				 <br>
                 è§’è‰²ï¼š<select name="" id="role_id">
				    	<!-- <option>è§’è‰²</option> -->
				 </select>
				 <input type="hidden" id="__token__" value="{$Request.token}" hidden="" />
				 <span id="add_span"></span>
				 </div>
				 <br>
				 <div class="row cl">
			          <!-- <label class="form-label col-xs-4 col-sm-3">ç½‘ç«™è§’è‰²ï¼š</label> -->
			          <div class="formControls">
				<dl class="permission-list"  id="permission-list">	
			</div>
		    </div>
				 
			</div>
			<div class="modal-footer">
				<button class="btn btn-primary" id="add">ç¡®å®š</button>
				<button class="btn" data-dismiss="modal" aria-hidden="true">å…³é—­</button>
			</div>
		</div>
	</div>
</div>

<div id="modal-demo1" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content radius">
			<div class="modal-header">
				<!-- <h3 class="modal-title">å¯¹è¯æ¡†æ ‡é¢˜</h3> -->
				<a class="close" data-dismiss="modal" aria-hidden="true" href="javascript:void();">Ã—</a>
			</div>
			<div class="modal-body">
				 <div class="row cl">
				 <input type="text" value="" id="up_id" >
				 ç”¨æˆ·åï¼š<input type="text" value="" id="up_user_name">
				 <br>
				  å¯†  ç ï¼š   <input type="text" value="" id="up_password">
				 <br>
				 æ‰‹æœºå·ï¼š<input type="text" value="" id="up_mobile">
				 <br>
                 è§’è‰²1ï¼š<select name="" id="up_role_id">
				    	<!-- <option>è§’è‰²</option> -->
				 </select>
				 <!-- <input type="hidden" id="__token__" value="{$Request.token}" hidden="" /> -->
				 <span id="add_span"></span>
				 </div>
				 <br>
				 <div class="row cl">
			          <!-- <label class="form-label col-xs-4 col-sm-3">ç½‘ç«™è§’è‰²ï¼š</label> -->
			          <div class="formControls">
				<dl class="permission-list"  id="permission-list">	
			</div>
		    </div>
				 
			</div>
			<div class="modal-footer">
				<button class="btn btn-primary"  onclick="up_action()">ç¡®å®š</button>
				<button class="btn" data-dismiss="modal" aria-hidden="true">å…³é—­</button>
			</div>
		</div>
	</div>
</div>
</section>
{include file="footer"}
<!--è¯·åœ¨ä¸‹æ–¹å†™æ­¤é¡µé¢ä¸šåŠ¡ç›¸å…³çš„è„šæœ¬-->  
<script>
	show()
    function modaldemo(){
	$("#modal-demo").modal("show")
}
     function getCate(str,id=0) {
			  	$.ajax({
			  		url:"{:url('role/show1')}",
			  		dataType:'json',
			  		success:function (res) {
			  			var option=''
			  			for (var i = 0; i < res.length; i++) {
						if (id==res[i].id) {
					        option=option+"<option value='"+res[i].id+"' selected>"+res[i].name+"</option>";		
						}else{
					        option=option+"<option value='"+res[i].id+"'>"+res[i].name+"</option>";	
						}
			  			 
			  			}
			          $('#'+str+'').html(option)

			  		}
	  	        })
	        }
	              getCate('role_id')
                  getCate('up_role_id')
    	 $(document).ready(function(){
          $('#add').click(function(){
              var __token__=$('#__token__').val()
              var user_name=$('#user_name').val()
              var password=$('#password').val()
              var mobile=$('#mobile').val()
              var role_id=$('#role_id').val()
              console.log(user_name)
              console.log(password)
              console.log(mobile)
              console.log(role_id)
            
     
    	    $.ajax({
    	 	url:'{:url("user/addAction")}',
    	 	  type:'post',
    	 	  data:{
    	 		__token__:__token__,
    	 		user_name:user_name,
    	 		password:password,
    	 		mobile:mobile,
    	 		role_id:role_id,
    	 	},
    	 	dataType:'json',
    	 	success:function(res){
                   console.log(res)
                  if (res.status=='ok') {
                   	 $("#add_span").html(res.data);
                                 $("#add_span").css("color",'green');
                                 $("#user_name").val('');
                                 $("#passowrd").val('');
                                 $("#mobile").val('');
                                 $("#role_id").val('');
                                 setTimeout(function(){
                                 $("#add_span").html('');
                                   },3000);
                                 show()
                                 }
                                 if (res.status=='error') {
                                 // alert(res.data);
                                 $("#add_span").html(res.data);
                                 $("#add_span").css("color",'red');
                   	 show()
                   }
    	     	}
    	 	})
    	 })
     });
    	function show() {
    	 $.ajax({
    	 	url:'{:url("user/show")}',
    	 	dataType:'json',
    	 	success:function(res){
    	 		if (res.status=='error') {
                      alert('æ²¡æœ‰æƒé™')
    	 		}else{
    	 		var data=res.data
    	 		var tr=''

    	 		for (var i = 0; i < data.length; i++) {
    	 			   tr=tr+"<tr><td><input type='checkbox'class='mycheckbox' value='"+data[i]['id']+"'><td>"+data[i]['id']+"</td></td><td>"+data[i]['user_name']+"</td><td>"+data[i]['password']+"</td><td>"+data[i]['mobile']+"</td><td>"+data[i]['name']+"</td><td>"+data[i]['create_time']+"</td><td></td><td class='f-14 product-brand-manage'><a  style='text-decoration:none' onclick='modaldemo1(\""+data[i]['id']+"\",\""+data[i]['user_name']+"\",\""+data[i]['password']+"\",\""+data[i]['mobile']+"\",\""+data[i]['role_id']+"\")'  title='ç¼–è¾‘'><i class='Hui-iconfont'>&#xe6df;</i></a> <a style='text-decoration:none' class='delete_one ml-5' onclick='delete1(\""+data[i]['id']+"\")' title='åˆ é™¤'><i class='Hui-iconfont'>&#xe6e2;</i></a></td></tr>";
    	 		}
    	 		$('.table tbody').html(tr)
    	 		}
    	 		
    	       }

    	    })
    	 }

  
    	  show()
    	  function delete1(id){
    	  	var __token__=$('#__token__').val()

    	  	$.ajax({
    	  		url:"{:url('user/delete')}",
    	  		type:'post',
    	  		data:{
    	  			id:id,
    	  			__token__:__token__
    	  		},
    	  		dataType:'json',
    	  		success:function(res){
    	  			if(res.status=='ok'){
    	  				alert('åˆ é™¤æˆåŠŸğŸ‘Œ');
    	  				show()
    	  				getToken()
    	  			}
    	  		}
    	  	})
    	  }

          function datade2() {
                 var __token__=$('#__token__').val()
                    var box=$(".mycheckbox:checked")
                    var id=''
                     for (var i = 0; i < box.length; i++) {
                        id=id+","+box[i].value
                     }
                     console.log()
                     $.ajax({
                        url:"{:url('user/datade2')}",
                        type:'post',
                        data:{
                            id:id,
                        __token__:__token__
                        },
                        dataType:'json',
                        success:function (res) {
                            console.log(res.data)
                            if (res.status=='ok') {
                                alert("åˆ é™¤æˆåŠŸâ˜º")
                                show()
                            }
                        }
                     })
                 }

    	 function modaldemo1(){
    	 	$("#modal-demo1").modal("show")
    	 }

    	function modaldemo1(id,user_name,password,mobile,role_id){
    	$("#up_id").val(id)
    	$("#up_user_name").val(user_name)
    	$("#up_password").val(password)
    	$("#up_mobile").val(mobile)
    	getCate('up_role_id',role_id)
    	$("#modal-demo1").modal("show")
    }
    	 function up_action(){
    	 	var up_id=$("#up_id").val()
    	 	var up_user_name=$('#up_user_name').val()
            var up_password=$('#up_password').val()
            var up_mobile=$('#up_mobile').val()
            var up_role_id=$('#up_role_id').val() 
            //console.log(up_role_id)
            $.ajax({
    	 	url:'{:url("user/updateaction")}',
    	 	  type:'post',
    	 	  data:{
    	 	  	up_id:up_id,
    	 		up_user_name:up_user_name,
    	 		up_password:up_password,
    	 		up_mobile:up_mobile,
    	 		up_role_id:up_role_id,
    	 	},
    	 	dataType:'json',
    	 	success:function(res){
    	 		console.log(res)
    	 		   getToken()
                   if (res.status=='ok') {
                   	$("#modal-demo1").modal("hide")
                   	 show()
                   }
                    if (res.status=='error') {
                   	$("#up_span").html(res.data)
                   	 
                   }
    	 	    }
    	 	})
    }

    	 

</script>
<script type="text/javascript" src="__STATIC__/hui/lib/My97DatePicker/4.8/WdatePicker.js"></script>  
<script type="text/javascript" src="__STATIC__/hui/lib/datatables/1.10.0/jquery.dataTables.min.js"></script> 
<script type="text/javascript" src="__STATIC__/hui/lib/laypage/1.2/laypage.js"></script>